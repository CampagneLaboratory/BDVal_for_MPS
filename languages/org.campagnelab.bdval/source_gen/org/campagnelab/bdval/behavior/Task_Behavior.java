package org.campagnelab.bdval.behavior;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.internal.collections.runtime.IVisitor;
import jetbrains.mps.internal.collections.runtime.IWhereFilter;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.baseLanguage.closures.runtime.Wrappers;
import java.util.Iterator;

public class Task_Behavior {
  public static void init(SNode thisNode) {
  }

  public static void call_getEndpoints_2366055488403471001(final SNode thisNode) {
    ListSequence.fromList(SLinkOperations.getTargets(SLinkOperations.getTarget(SNodeOperations.cast(SNodeOperations.getParent(thisNode), "org.campagnelab.bdval.structure.DataSet"), "input", true), "sample", true)).visitAll(new IVisitor<SNode>() {
      public void visit(final SNode sample) {
        SNode categoryNode = ListSequence.fromList(SLinkOperations.getTargets(thisNode, "categoryReference", true)).findFirst(new IWhereFilter<SNode>() {
          public boolean accept(SNode categoryRef) {
            return SPropertyOperations.getString(sample, "name").contains(SPropertyOperations.getString(SLinkOperations.getTarget(categoryRef, "endpointCategory", false), "name"));
          }
        });
        if ((categoryNode != null)) {
          SLinkOperations.setTarget(sample, "category", categoryNode, false);
        }
      }
    });
  }

  public static boolean call_checkForEndpoints_8962624141198443578(SNode thisNode) {
    final Wrappers._boolean nameHasEndpoint = new Wrappers._boolean(false);
    Iterator sampleIterator = SLinkOperations.getTargets(SLinkOperations.getTarget(SNodeOperations.cast(SNodeOperations.getParent(thisNode), "org.campagnelab.bdval.structure.DataSet"), "input", true), "sample", true).iterator();
    final Wrappers._T<SNode> sample = new Wrappers._T<SNode>();
    while (!(nameHasEndpoint.value) && sampleIterator.hasNext()) {
      sample.value = (SNode) sampleIterator.next();
      ListSequence.fromList(SLinkOperations.getTargets(thisNode, "categoryReference", true)).visitAll(new IVisitor<SNode>() {
        public void visit(SNode categoryRef) {
          nameHasEndpoint.value = nameHasEndpoint.value || (isNotEmptyString(SPropertyOperations.getString(sample.value, "name")) && SPropertyOperations.getString(sample.value, "name").contains(SPropertyOperations.getString(SLinkOperations.getTarget(categoryRef, "endpointCategory", false), "name")));
        }
      });
    }
    return nameHasEndpoint.value;
  }

  public static void call_clearCategoryAssignments_8962624141199537893(SNode thisNode) {
    ListSequence.fromList(SLinkOperations.getTargets(SLinkOperations.getTarget(SNodeOperations.cast(SNodeOperations.getParent(thisNode), "org.campagnelab.bdval.structure.DataSet"), "input", true), "sample", true)).visitAll(new IVisitor<SNode>() {
      public void visit(SNode sample) {
        SLinkOperations.setTarget(sample, "category", null, false);
      }
    });
  }

  private static boolean isNotEmptyString(String str) {
    return str != null && str.length() > 0;
  }
}
