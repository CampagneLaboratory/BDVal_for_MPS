package org.campagnelab.bdval.behavior;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import org.bdval.DAVMode;
import edu.mssm.crover.tables.Table;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;

public class Input_Behavior {
  public static void init(SNode thisNode) {
  }

  public static void call_load_7052920786130144602(SNode thisNode) {
    ListSequence.fromList(SLinkOperations.getTargets(thisNode, "display", true)).removeSequence(ListSequence.fromList(SLinkOperations.getTargets(thisNode, "display", true)));
    ListSequence.fromList(SLinkOperations.getTargets(thisNode, "sampleId", true)).removeSequence(ListSequence.fromList(SLinkOperations.getTargets(thisNode, "sampleId", true)));
    try {
      final DAVMode davMode = new DAVMode();
      Table inputTable = davMode.getReadInputFile(SPropertyOperations.getString(thisNode, "inputFileName"));
      int cols = inputTable.getColumnNumber();
      SPropertyOperations.set(thisNode, "numberOfSamples", "" + (cols - 1));
      Input_Behavior.call_getInputIds_7052920786130389579(thisNode, inputTable, cols);
      Input_Behavior.call_getInputDisplay_3367122381600071702(thisNode, inputTable, cols);
    } catch (Exception e) {
      throw new IllegalArgumentException("failed");
    }
  }

  public static void call_getInputIds_7052920786130389579(SNode thisNode, Table inputTable, int cols) {
    int counter = 1;
    while (counter < cols) {
      String idString = inputTable.getIdentifier(counter);
      SNode idNode = SConceptOperations.createNewNode("org.campagnelab.bdval.structure.SampleId", null);
      SPropertyOperations.set(idNode, "name", idString);
      ListSequence.fromList(SLinkOperations.getTargets(thisNode, "sampleId", true)).addElement(idNode);
      counter++;
    }
  }

  public static void call_getInputDisplay_3367122381600071702(SNode thisNode, Table inputTable, int cols) {
    int colMax;
    if (cols < 10) {
      colMax = cols;
    } else {
      colMax = 10;
    }
    int rowMax;
    int rows = inputTable.getRowNumber();
    if (rows < 10) {
      rowMax = rows;
    } else {
      rowMax = 10;
    }
    // Gets the first row 
    int colCounter = 0;
    SNode rowNode = SConceptOperations.createNewNode("org.campagnelab.bdval.structure.DisplayRow", null);
    while (colCounter < colMax) {
      try {
        SNode valNode = SConceptOperations.createNewNode("org.campagnelab.bdval.structure.DisplayValue", null);
        SPropertyOperations.set(valNode, "value", inputTable.getIdentifier(colCounter));
        ListSequence.fromList(SLinkOperations.getTargets(rowNode, "value", true)).addElement(valNode);
      } catch (Exception e) {
        throw new IllegalArgumentException("Could not access first row of input table in getInputDisplay");
      }
      colCounter++;
    }
    ListSequence.fromList(SLinkOperations.getTargets(thisNode, "display", true)).addElement(rowNode);
    // Gets the following rows 
    Table.RowIterator rowIterator = inputTable.firstRow();
    rowIterator.next();
    int rowCounter = 1;
    while (rowCounter < rowMax) {
      rowNode = SConceptOperations.createNewNode("org.campagnelab.bdval.structure.DisplayRow", null);
      colCounter = 0;
      while (colCounter < colMax) {
        try {
          SNode valNode = SConceptOperations.createNewNode("org.campagnelab.bdval.structure.DisplayValue", null);
          SPropertyOperations.set(valNode, "value", inputTable.elementToString(colCounter, rowIterator));
          ListSequence.fromList(SLinkOperations.getTargets(rowNode, "value", true)).addElement(valNode);
        } catch (Exception e) {
          throw new IllegalArgumentException("Could not access middle row of input table in getInputDisplay");
        }
        colCounter++;
      }
      ListSequence.fromList(SLinkOperations.getTargets(thisNode, "display", true)).addElement(rowNode);
      rowIterator.next();
      rowCounter++;
    }
  }
}
